# Reflector Secret Synchronization Rules
# ========================================
# Reflector automatically syncs secrets across namespaces based on annotations.
# 
# How it works:
# 1. Add annotations to source secret in kube-system
# 2. Reflector detects annotations and syncs to target namespaces
# 3. Target secret is auto-created if it doesn't exist
#
# Source annotation format:
#   reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
#   reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
#   reflector.v1.k8s.emberstack.com/reflection-allowed-namespaces: "ns1,ns2,ns3"

---
# DigitalOcean API Token Synchronization
# Source: kube-system/digitalocean (created by do_cloud_controller_manager.yml)
# Target: monitoring/digitalocean (synced by reflector)
apiVersion: v1
kind: ConfigMap
metadata:
  name: reflector-secret-sync-config
  namespace: kube-system
data:
  digitalocean-sync-config: |
    {
      "source": {
        "namespace": "kube-system",
        "name": "digitalocean",
        "key": "access-token"
      },
      "targets": [
        {
          "namespace": "monitoring",
          "name": "digitalocean"
        }
      ],
      "annotations": {
        "reflector.v1.k8s.emberstack.com/reflection-allowed": "true",
        "reflector.v1.k8s.emberstack.com/reflection-auto-enabled": "true",
        "reflector.v1.k8s.emberstack.com/reflection-allowed-namespaces": "monitoring"
      },
      "description": "DO API token from CCM synced to monitoring for cost exporter"
    }
