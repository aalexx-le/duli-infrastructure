# Cloudflared values for STAGING environment
cloudflare:
  account: ""
  tunnelName: "duli-tunnel"
  tunnelId: ""
  secret: ""
  secretName: cloudflared-credentials
  enableWarp: true
  edgeIPVersion: "4"
  ingress:
    # HTTP services - route to ingress-nginx
    - hostname: api.staging.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: ai.staging.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: auth.staging.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: n8n.staging.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: queue.staging.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    # TCP services - direct connection
    - hostname: db.staging.duli.one
      service: tcp://database-rw.staging.svc.cluster.local:5432
    - hostname: redis.staging.duli.one
      service: tcp://redis-replication.staging.svc.cluster.local:6379
    - hostname: mq.staging.duli.one
      service: tcp://queue.staging.svc.cluster.local:5672

image:
  repository: cloudflare/cloudflared
  pullPolicy: IfNotPresent
  tag: "2024.12.2"

replicaCount: 1

serviceAccount:
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "2000"
  prometheus.io/path: "/metrics"

podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  sysctls:
    - name: net.ipv4.ping_group_range
      value: "65532 65532"

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 128Mi

livenessProbe:
  httpGet:
    path: /ready
    port: 2000
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 2000
  initialDelaySeconds: 5
  periodSeconds: 5
  successThreshold: 1
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - cloudflare-tunnel
          topologyKey: kubernetes.io/hostname
