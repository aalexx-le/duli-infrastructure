# Cloudflared values for PRODUCTION environment
cloudflare:
  account: ""
  tunnelName: "duli-tunnel"
  tunnelId: ""
  secret: ""
  secretName: cloudflared-credentials
  enableWarp: true
  edgeIPVersion: "4"
  ingress:
    # HTTP services - route to ingress-nginx
    - hostname: api.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: ai.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: auth.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: n8n.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: queue.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: argocd.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    - hostname: rancher.duli.one
      service: http://ingress-nginx.ingress-nginx.svc.cluster.local:80
    # TCP services - direct connection
    - hostname: db.duli.one
      service: tcp://database-rw.prod.svc.cluster.local:5432
    - hostname: redis.duli.one
      service: tcp://redis-replication.prod.svc.cluster.local:6379
    - hostname: mq.duli.one
      service: tcp://queue.prod.svc.cluster.local:5672

image:
  repository: cloudflare/cloudflared
  pullPolicy: IfNotPresent
  tag: "2024.12.2"

replicaCount: 2

serviceAccount:
  annotations: {}
  name: ""

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "2000"
  prometheus.io/path: "/metrics"

podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  sysctls:
    - name: net.ipv4.ping_group_range
      value: "65532 65532"

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi

livenessProbe:
  httpGet:
    path: /ready
    port: 2000
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 2000
  initialDelaySeconds: 5
  periodSeconds: 5
  successThreshold: 1
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - cloudflare-tunnel
          topologyKey: kubernetes.io/hostname
