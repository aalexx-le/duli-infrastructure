# ============================================================================
# Backend Application Helm Values - Staging
# ============================================================================
# Staging environment configuration for Backend service
# Used by ArgoCD with Helm native support
# Deployed to: staging namespace

replicaCount: 3

image:
  repository: registry.gitlab.com/duli.ai-engineering/duli-ai-backend
  tag: latest
  pullPolicy: Always

nameOverride: ""
fullnameOverride: ""

# Kubernetes Standard Labels (applied to all pods, services, deployments)
labels:
  app.kubernetes.io/name: backend
  app.kubernetes.io/component: api
  app.kubernetes.io/instance: duli-backend
  app.kubernetes.io/version: "latest"
  app.kubernetes.io/managed-by: argocd
  environment: staging
  team: backend-team
  tier: application

# Service
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

# Resource limits (staging: moderate)
resources:
  limits:
    cpu: "1000m"
    memory: "512Mi"
  requests:
    cpu: "500m"
    memory: "256Mi"

# Environment variables
env:
  - name: NODE_ENV
    value: "staging"
  - name: LOG_LEVEL
    value: "debug"
  - name: DATABASE_HOST
    value: "database-rw.staging.svc.cluster.local"
  - name: DATABASE_PORT
    value: "5432"
  - name: DATABASE_NAME
    value: "duli_db"
  - name: REDIS_HOST
    value: "redis-master.staging.svc.cluster.local"
  - name: REDIS_PORT
    value: "6379"

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Pod disruption budget (staging: minimal)
podDisruptionBudget:
  enabled: false

# Autoscaling (staging: disabled for cost)
autoscaling:
  enabled: false
  minReplicas: 3
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80

# Pod security
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  runAsNonRoot: false

# Ingress Configuration
ingress:
  enabled: true
  className: nginx
  host: "api.duli.one"
  path: /
  pathType: Prefix
  clusterIssuer: "letsencrypt-prod"
  proxyBodySize: "100m"
  proxyReadTimeout: "600"
  proxySendTimeout: "600"
  enableCors: true
  corsAllowOrigin: "*"
  tls:
    enabled: true
    secretName: "duli-one-wildcard-tls"
  annotations: {}
