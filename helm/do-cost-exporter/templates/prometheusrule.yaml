apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: cost-monitoring
  namespace: monitoring
spec:
  groups:
    - name: cost.rules
      interval: 30s
      rules:
        # Cost anomaly detection - only fires when cost spikes unexpectedly
        - alert: CostAnomalyDetected
          expr: |
            abs(sum(do_cost_exporter_resource_cost) - avg_over_time(sum(do_cost_exporter_resource_cost)[7d]))
            > (avg_over_time(sum(do_cost_exporter_resource_cost)[7d]) * 0.25)
          for: 10m
          labels:
            severity: warning
            category: cost
          annotations:
            summary: "⚠️ Cost Anomaly Detected"
            description: "Daily cost deviation exceeds 25% from 7-day average. Check for unexpected resources."
